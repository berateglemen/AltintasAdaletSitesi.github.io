<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Güvenli Ödeme Sorgulama</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { background-color: #f3f4f6; }
        .main-card { max-width: 400px; margin: 60px auto; border-radius: 15px; overflow: hidden; }
        .input-group { margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="w3-container">
    <div class="w3-card-4 w3-white main-card w3-animate-zoom">
        <header class="w3-container w3-dark-grey w3-center w3-padding-16">
            <h4 class="w3-wide">MÜŞTERİ GİRİŞİ</h4>
        </header>

        <div id="loginForm" class="w3-container w3-padding-24">
            <div class="input-group">
                <label class="w3-text-grey"><b>Ad Soyad</b></label>
                <input class="w3-input w3-border w3-round" type="text" id="username" placeholder="Örn: Ahmet Yılmaz">
            </div>
            
            <div class="input-group">
                <label class="w3-text-grey"><b>Güvenlik Kodu</b></label>
                <input class="w3-input w3-border w3-round" type="password" id="usercode" placeholder="Size verilen kod">
            </div>
            
            <button onclick="sorgula()" class="w3-button w3-block w3-black w3-round w3-margin-top w3-padding-large">SORGULA</button>
            <p class="w3-small w3-center w3-text-grey">Kodunuzu bilmiyorsanız yönetici ile iletişime geçin.</p>
        </div>

        <div id="resultArea" class="w3-container w3-padding-24 w3-animate-right" style="display:none">
            <div class="w3-center">
                <span class="w3-tag w3-teal w3-round">Doğrulandı <i class="w3-small">✓</i></span>
                <h3 id="welcomeMsg" class="w3-border-bottom w3-padding-16"></h3>
            </div>
            
            <div class="w3-row w3-padding-16">
                <div class="w3-col s6"><b>Toplam Ödeme:</b></div>
                <div id="resOdenen" class="w3-col s6 w3-right-align w3-text-green w3-large"></div>
            </div>
            
            <div class="w3-row w3-padding-16 w3-border-top">
                <div class="w3-col s6"><b>Kalan Borç:</b></div>
                <div id="resBorc" class="w3-col s6 w3-right-align w3-text-red w3-large"></div>
            </div>

            <button onclick="location.reload()" class="w3-button w3-block w3-light-grey w3-round w3-margin-top">Geri Dön</button>
        </div>
    </div>
</div>

<script>
function sorgula() {
    const name = document.getElementById('username').value.trim().toLowerCase();
    const code = document.getElementById('usercode').value.trim();

    if(!name || !code) { 
        alert("Lütfen adınızı ve kodunuzu girin!"); 
        return; 
    }

    // CSV'yi çek ve işle
    fetch('veriler.csv?t=' + Date.now())
    .then(res => res.text())
    .then(data => {
        const results = Papa.parse(data, { header: true, skipEmptyLines: true }).data;
        
        // İsmi ve Kodu eşleşen kişiyi filtrele
        const user = results.find(row => 
            row.Isim && row.Isim.toLowerCase() === name && 
            row.Kod && row.Kod.toString() === code
        );

        if(user) {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('welcomeMsg').innerText = user.Isim;
            document.getElementById('resOdenen').innerText = user.Odenen + " TL";
            document.getElementById('resBorc').innerText = user.Borc + " TL";
        } else {
            alert("Hata: Adınız veya güvenlik kodunuz eşleşmiyor!");
        }
    })
    .catch(err => alert("Veri dosyasına ulaşılamadı. İnternet bağlantınızı kontrol edin."));
}
</script>

</body>
</html>
